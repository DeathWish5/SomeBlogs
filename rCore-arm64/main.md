## 技术方案

### 核心目标

* 增加 aarch64 支持，兼容 ch1-8 功能
* 增加 HAL 抽象，方便跨平台支持
* 简化封装，降低代码复杂性

### 实现细节

在继承原有实现的基础上，各分支有如下扩展与修改。

* ch1: boot 与串口输出
    * arm64 无 sbi 提供串口控制，需要自行实现 PL011 串口输出
    * 使用 hvc 实现 shutdown
* ch2: 基本用户程序与 syscall 支持
    * 实现内核/用户态切换代码，支持异常处理
    * 增加 `arch.rs` 文件，统一管理硬件相关代码
* ch3: 任务切换与时钟中断
    * 实现 arm64 任务上下文切换
    * 实现 arm64 时钟中断控制
    * 增加基本同步接口 Mutex，方便后续替换
    * 增加 `arch` 目录，统一管理硬件相关代码
    * 简化 `TaskManager` 实现，增加 `CurrentTask` 抽象以简化代码封装
* ch4: 内存管理
    * 实现 arm64 页表管理
    * 简化页表管理结构 `MapArea` 实现，分离物理页，虚拟页，内核堆管理
    * 去除 `FrameTracker` 抽象，简化物理页分配/删除的实现
    * 增加 `User[In][Out]Ptr` 抽象，规范用户内存检查
    * 规范虚拟内存使用，不再使用对等映射，内核使用以 `0xffff...` 开头的高地址
* ch5: 更加完善的进程管理与 usershell
    * 增加串口读取功能
    * 调整 `TaskManager` 实现
        * 增加 `Scheduler` 抽象，方便实现多种调度算法
        * 完善 `CurrentTask` 实现，增加 `PerCpu` 数据
        * 增加 `TaskLockedCell` 实现，简化 `TaskManager` 与 TCB 锁的冗余操作。
        * 在完善进程抽象的基础上，重命名部分接口和数据结构

### TODO

* 总体: 
    * 增加更多注释辅助理解代码
    * 补充相关文档
* ch6: 文件系统
    * 与平台相关性不大
    * 主要目标：优化文件管理与抽象，规范文件系统实现
* ch7: 进程间通信与 IO 重定向
    * 与平台相关性不大
    * 主要目标：规范 syscall 接口设计，简化同步代码（主要是锁的使用）
* ch8: 多核与并发
    * 需要修改较多
        * 更加完善的同步互斥机制
        * 多核启动
        * 内核中断处理

